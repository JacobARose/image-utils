<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>imutils.ml.utils.common API documentation</title>
<meta name="description" content="imutils/ml/utils/common.py …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>imutils.ml.utils.common</code></h1>
</header>
<section id="section-intro">
<p>imutils/ml/utils/common.py</p>
<p>Created on: Wednesday March 16th, 2022<br>
Created by: Jacob Alexander Rose</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;

imutils/ml/utils/common.py

Created on: Wednesday March 16th, 2022  
Created by: Jacob Alexander Rose  


&#34;&#34;&#34;







import os
from typing import Any, Dict, List, Optional

import dotenv
import matplotlib.pyplot as plt
import numpy as np
import torch
import torchvision

import math
import numpy as np
import torch.optim as optim


__all__ = [&#34;get_env&#34;, &#34;load_envs&#34;, &#34;render_images&#34;, &#34;iterate_elements_in_batches&#34;, &#34;TwoCropTransform&#34;, &#34;AverageMeter&#34;]




def get_env(env_name: str) -&gt; str:
    &#34;&#34;&#34;
    Safely read an environment variable.
    Raises errors if it is not defined or it is empty.

    :param env_name: the name of the environment variable
    :return: the value of the environment variable
    &#34;&#34;&#34;
    if env_name not in os.environ:
        raise KeyError(f&#34;{env_name} not defined&#34;)
    env_value: str = os.environ[env_name]
    if not env_value:
        raise ValueError(f&#34;{env_name} has yet to be configured&#34;)
    return env_value


def load_envs(env_file: Optional[str] = None) -&gt; None:
    &#34;&#34;&#34;
    Load all the environment variables defined in the `env_file`.
    This is equivalent to `. env_file` in bash.

    It is possible to define all the system specific variables in the `env_file`.

    :param env_file: the file that defines the environment variables to use. If None
                     it searches for a `.env` file in the project.
    &#34;&#34;&#34;
    dotenv.load_dotenv(dotenv_path=env_file, override=True)


def render_images(
    batch: torch.Tensor, nrow=8, title: str = &#34;Images&#34;, autoshow: bool = True, normalize: bool = True
) -&gt; np.ndarray:
    &#34;&#34;&#34;
    Utility function to render and plot a batch of images in a grid

    :param batch: batch of images
    :param nrow: number of images per row
    :param title: title of the image
    :param autoshow: if True calls the show method
    :return: the image grid
    &#34;&#34;&#34;
    image = (
        torchvision.utils.make_grid(
            batch.detach().cpu(), nrow=nrow, padding=2, normalize=normalize
        )
        .permute((1, 2, 0))
        .numpy()
        # .astype(np.uint8)
    )

    if autoshow:
        plt.figure(figsize=(8, 8))
        plt.axis(&#34;off&#34;)
        plt.title(title)
        plt.imshow(image)
        plt.show()
    return image


def iterate_elements_in_batches(
    outputs: List[Dict[str, torch.Tensor]], batch_size: int, n_elements: int
) -&gt; Dict[str, torch.Tensor]:
    &#34;&#34;&#34;
    Iterate over elements across multiple batches in order, independently to the
    size of each batch

    :param outputs: a list of outputs dictionaries
    :param batch_size: the size of each batch
    :param n_elements: the number of elements to iterate over

    :return: yields one element at the time
    &#34;&#34;&#34;
    count = 0
    for output in outputs:
        for i in range(batch_size):
            count += 1
            if count &gt;= n_elements:
                return
            yield {
                key: value if len(value.shape) == 0 else value[i]
                for key, value in output.items()
            }








class TwoCropTransform:
    &#34;&#34;&#34;Create two crops of the same image&#34;&#34;&#34;
    def __init__(self, transform):
        self.transform = transform

    def __call__(self, x):
        return [self.transform(x), self.transform(x)]


class AverageMeter(object):
    &#34;&#34;&#34;Computes and stores the average and current value&#34;&#34;&#34;
    def __init__(self):
        self.reset()

    def reset(self):
        self.val = 0
        self.avg = 0
        self.sum = 0
        self.count = 0

    def update(self, val, n=1):
        self.val = val
        self.sum += val * n
        self.count += n
        self.avg = self.sum / self.count


def accuracy(output, target, topk=(1,)):
    &#34;&#34;&#34;Computes the accuracy over the k top predictions for the specified values of k&#34;&#34;&#34;
    with torch.no_grad():
        maxk = max(topk)
        batch_size = target.size(0)

        _, pred = output.topk(maxk, 1, True, True)
        pred = pred.t()
        correct = pred.eq(target.view(1, -1).expand_as(pred))

        res = []
        for k in topk:
            correct_k = correct[:k].view(-1).float().sum(0, keepdim=True)
            res.append(correct_k.mul_(100.0 / batch_size))
        return res


def adjust_learning_rate(args, optimizer, epoch):
    lr = args.learning_rate
    if args.cosine:
        eta_min = lr * (args.lr_decay_rate ** 3)
        lr = eta_min + (lr - eta_min) * (
                1 + math.cos(math.pi * epoch / args.epochs)) / 2
    else:
        steps = np.sum(epoch &gt; np.asarray(args.lr_decay_epochs))
        if steps &gt; 0:
            lr = lr * (args.lr_decay_rate ** steps)

    for param_group in optimizer.param_groups:
        param_group[&#39;lr&#39;] = lr


def warmup_learning_rate(args, epoch, batch_id, total_batches, optimizer):
    if args.warm and epoch &lt;= args.warm_epochs:
        p = (batch_id + (epoch - 1) * total_batches) / \
            (args.warm_epochs * total_batches)
        lr = args.warmup_from + p * (args.warmup_to - args.warmup_from)

        for param_group in optimizer.param_groups:
            param_group[&#39;lr&#39;] = lr


def set_optimizer(opt, model):
    optimizer = optim.SGD(model.parameters(),
                          lr=opt.learning_rate,
                          momentum=opt.momentum,
                          weight_decay=opt.weight_decay)
    return optimizer


def save_model(model, optimizer, opt, epoch, save_file):
    print(&#39;==&gt; Saving...&#39;)
    state = {
        &#39;opt&#39;: opt,
        &#39;model&#39;: model.state_dict(),
        &#39;optimizer&#39;: optimizer.state_dict(),
        &#39;epoch&#39;: epoch,
    }
    torch.save(state, save_file)
    del state</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="imutils.ml.utils.common.get_env"><code class="name flex">
<span>def <span class="ident">get_env</span></span>(<span>env_name: str) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Safely read an environment variable.
Raises errors if it is not defined or it is empty.</p>
<p>:param env_name: the name of the environment variable
:return: the value of the environment variable</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_env(env_name: str) -&gt; str:
    &#34;&#34;&#34;
    Safely read an environment variable.
    Raises errors if it is not defined or it is empty.

    :param env_name: the name of the environment variable
    :return: the value of the environment variable
    &#34;&#34;&#34;
    if env_name not in os.environ:
        raise KeyError(f&#34;{env_name} not defined&#34;)
    env_value: str = os.environ[env_name]
    if not env_value:
        raise ValueError(f&#34;{env_name} has yet to be configured&#34;)
    return env_value</code></pre>
</details>
</dd>
<dt id="imutils.ml.utils.common.iterate_elements_in_batches"><code class="name flex">
<span>def <span class="ident">iterate_elements_in_batches</span></span>(<span>outputs: List[Dict[str, torch.Tensor]], batch_size: int, n_elements: int) ‑> Dict[str, torch.Tensor]</span>
</code></dt>
<dd>
<div class="desc"><p>Iterate over elements across multiple batches in order, independently to the
size of each batch</p>
<p>:param outputs: a list of outputs dictionaries
:param batch_size: the size of each batch
:param n_elements: the number of elements to iterate over</p>
<p>:return: yields one element at the time</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def iterate_elements_in_batches(
    outputs: List[Dict[str, torch.Tensor]], batch_size: int, n_elements: int
) -&gt; Dict[str, torch.Tensor]:
    &#34;&#34;&#34;
    Iterate over elements across multiple batches in order, independently to the
    size of each batch

    :param outputs: a list of outputs dictionaries
    :param batch_size: the size of each batch
    :param n_elements: the number of elements to iterate over

    :return: yields one element at the time
    &#34;&#34;&#34;
    count = 0
    for output in outputs:
        for i in range(batch_size):
            count += 1
            if count &gt;= n_elements:
                return
            yield {
                key: value if len(value.shape) == 0 else value[i]
                for key, value in output.items()
            }</code></pre>
</details>
</dd>
<dt id="imutils.ml.utils.common.load_envs"><code class="name flex">
<span>def <span class="ident">load_envs</span></span>(<span>env_file: Optional[str] = None) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Load all the environment variables defined in the <code>env_file</code>.
This is equivalent to <code>. env_file</code> in bash.</p>
<p>It is possible to define all the system specific variables in the <code>env_file</code>.</p>
<p>:param env_file: the file that defines the environment variables to use. If None
it searches for a <code>.env</code> file in the project.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_envs(env_file: Optional[str] = None) -&gt; None:
    &#34;&#34;&#34;
    Load all the environment variables defined in the `env_file`.
    This is equivalent to `. env_file` in bash.

    It is possible to define all the system specific variables in the `env_file`.

    :param env_file: the file that defines the environment variables to use. If None
                     it searches for a `.env` file in the project.
    &#34;&#34;&#34;
    dotenv.load_dotenv(dotenv_path=env_file, override=True)</code></pre>
</details>
</dd>
<dt id="imutils.ml.utils.common.render_images"><code class="name flex">
<span>def <span class="ident">render_images</span></span>(<span>batch: torch.Tensor, nrow=8, title: str = 'Images', autoshow: bool = True, normalize: bool = True) ‑> numpy.ndarray</span>
</code></dt>
<dd>
<div class="desc"><p>Utility function to render and plot a batch of images in a grid</p>
<p>:param batch: batch of images
:param nrow: number of images per row
:param title: title of the image
:param autoshow: if True calls the show method
:return: the image grid</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def render_images(
    batch: torch.Tensor, nrow=8, title: str = &#34;Images&#34;, autoshow: bool = True, normalize: bool = True
) -&gt; np.ndarray:
    &#34;&#34;&#34;
    Utility function to render and plot a batch of images in a grid

    :param batch: batch of images
    :param nrow: number of images per row
    :param title: title of the image
    :param autoshow: if True calls the show method
    :return: the image grid
    &#34;&#34;&#34;
    image = (
        torchvision.utils.make_grid(
            batch.detach().cpu(), nrow=nrow, padding=2, normalize=normalize
        )
        .permute((1, 2, 0))
        .numpy()
        # .astype(np.uint8)
    )

    if autoshow:
        plt.figure(figsize=(8, 8))
        plt.axis(&#34;off&#34;)
        plt.title(title)
        plt.imshow(image)
        plt.show()
    return image</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="imutils.ml.utils.common.AverageMeter"><code class="flex name class">
<span>class <span class="ident">AverageMeter</span></span>
</code></dt>
<dd>
<div class="desc"><p>Computes and stores the average and current value</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class AverageMeter(object):
    &#34;&#34;&#34;Computes and stores the average and current value&#34;&#34;&#34;
    def __init__(self):
        self.reset()

    def reset(self):
        self.val = 0
        self.avg = 0
        self.sum = 0
        self.count = 0

    def update(self, val, n=1):
        self.val = val
        self.sum += val * n
        self.count += n
        self.avg = self.sum / self.count</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="imutils.ml.utils.common.AverageMeter.reset"><code class="name flex">
<span>def <span class="ident">reset</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def reset(self):
    self.val = 0
    self.avg = 0
    self.sum = 0
    self.count = 0</code></pre>
</details>
</dd>
<dt id="imutils.ml.utils.common.AverageMeter.update"><code class="name flex">
<span>def <span class="ident">update</span></span>(<span>self, val, n=1)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update(self, val, n=1):
    self.val = val
    self.sum += val * n
    self.count += n
    self.avg = self.sum / self.count</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="imutils.ml.utils.common.TwoCropTransform"><code class="flex name class">
<span>class <span class="ident">TwoCropTransform</span></span>
<span>(</span><span>transform)</span>
</code></dt>
<dd>
<div class="desc"><p>Create two crops of the same image</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class TwoCropTransform:
    &#34;&#34;&#34;Create two crops of the same image&#34;&#34;&#34;
    def __init__(self, transform):
        self.transform = transform

    def __call__(self, x):
        return [self.transform(x), self.transform(x)]</code></pre>
</details>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="imutils.ml.utils" href="index.html">imutils.ml.utils</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="imutils.ml.utils.common.get_env" href="#imutils.ml.utils.common.get_env">get_env</a></code></li>
<li><code><a title="imutils.ml.utils.common.iterate_elements_in_batches" href="#imutils.ml.utils.common.iterate_elements_in_batches">iterate_elements_in_batches</a></code></li>
<li><code><a title="imutils.ml.utils.common.load_envs" href="#imutils.ml.utils.common.load_envs">load_envs</a></code></li>
<li><code><a title="imutils.ml.utils.common.render_images" href="#imutils.ml.utils.common.render_images">render_images</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="imutils.ml.utils.common.AverageMeter" href="#imutils.ml.utils.common.AverageMeter">AverageMeter</a></code></h4>
<ul class="">
<li><code><a title="imutils.ml.utils.common.AverageMeter.reset" href="#imutils.ml.utils.common.AverageMeter.reset">reset</a></code></li>
<li><code><a title="imutils.ml.utils.common.AverageMeter.update" href="#imutils.ml.utils.common.AverageMeter.update">update</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="imutils.ml.utils.common.TwoCropTransform" href="#imutils.ml.utils.common.TwoCropTransform">TwoCropTransform</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>